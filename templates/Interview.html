{% extends "base_dashboard.html" %}

{% block content %}
<div class="container mt-4">
    <h1 class="mt-4">Input Your New Interview Here</h1>
    <p>Upload the candidate's interview video file (MP4 or WebM) for processing.</p>
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="flashed-messages">
            {% for category, message in messages %}
                <div class="alert alert-{{ 'danger' if category == 'error' else 'success' }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
            {% endfor %}
            </div>
        {% endif %}
    {% endwith %}
    <form method="POST" action="{{ url_for('new_interview') }}" enctype="multipart/form-data" class="mt-4 p-4 "
      onsubmit="if (this.dataset.submitted) return false;">
        <div class="form-group">
            <div  class = "card shadow-sm mb-4 p-3">
                {% if candidates %}
                <div class="alert alert-info">
                        DEBUG: Candidates loaded successfully! Total: {{ candidates | length }}
                        <br>
                        First Candidate Data: {{ candidates[0] }}
                    </div>
                {% else %}
                    <div class="alert alert-warning">
                        DEBUG: Candidate list is EMPTY or not loaded!
                    </div>
                {% endif %}
                    <label for="candidate">Choose Candidate : </label>
                    <select name="candidate_id" id="candidate" class="form-select" style = "max-width: 200px;"required>
                        <option value="" disabled selected hidden> Choose Candidate</option>
                        <option value = 1> Bambang</option>
                        <option value = 4> Amy</option>
                        {% for c in candidates %}
                        <option value= "{{ c[0] }}"> {{ c[1] }} ({{ c[2] }})</option>
                        {% endfor %}
                        
                    </select>
            </div>
            <div class = "card shadow-sm mb-4 p-3">
                <label for="interview_video">Upload Video for Question 1: </label>
                <input type="file" class="form-control-file" id="interview_video1" name="interview_video1" accept=".mp4,.webm" required>
            </div>
            <div class = "card shadow-sm mb-4 p-3">
                <label for="interview_video">Upload Video for Question 2: </label>
                <input type="file" class="form-control-file" id="interview_video2" name="interview_video2" accept=".mp4,.webm" required>
            </div>
            <div  class = "card shadow-sm mb-4 p-3">
                <label for="interview_video">Upload Video for Question 3: </label>
                <input type="file" class="form-control-file" id="interview_video3" name="interview_video3" accept=".mp4,.webm" required>
            </div>
            <div  class = "card shadow-sm mb-4 p-3">
                <label for="interview_video">Upload Video for Question 4: </label>
                <input type="file" class="form-control-file" id="interview_video4" name="interview_video4" accept=".mp4,.webm" required>
            </div>
            <div class = "card shadow-sm mb-4 p-3">
                <label for="interview_video">Upload Video for Question 5: </label>
                <input type="file" class="form-control-file" id="interview_video5" name="interview_video5" accept=".mp4,.webm" required>
            </div>
        </div>
        
        <button type="submit" id="submitBtn" class="btn btn-primary mt-3">
            Start Processing Interview
        </button>
    </form>
    <div id="loadingSpinner" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; 
        background: rgba(0,0,0,0.5); z-index:10000; justify-content:center; align-items:center;">
        <div class="spinner-border text-light" role="status" style="width:4rem; height:4rem;">
            <span class="sr-only">Loading...</span>
        </div>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const form = document.querySelector("form");
    const spinner = document.getElementById("loadingSpinner");

    form.addEventListener("submit", function() {
        // Tampilkan spinner saat submit
        spinner.style.display = "flex";
    });
});

form.addEventListener("submit", function() {
    spinner.style.display = "flex";

    // Disable button
    const btn = document.getElementById("submitBtn");
    btn.disabled = true;
    btn.innerText = "Processing..."; 
});

</script>
{% endblock %}